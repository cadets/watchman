# WATCHMAN

WATCHMAN is a tool for tracking temporal automata over time.
Such automata, pioneered in the TESLA system, are useful for describing
run-time interactions among values (including objects), whether to check
conformity to expected behaviour or to reduce complex streams of
causally-related events into abstract meta-events.

WATCHMAN is currently designed as a library to link into the address space of
an application that wishes to track temporal automata.
Future work will include stand-alone applications to analyze trace logs or
aggregate events from multiple sources on a host.

This software was developed by BAE Systems, the University of Cambridge
Computer Laboratory, and Memorial University under DARPA/AFRL contract
FA8650-15-C-7558 ("CADETS"), as part of the DARPA Transparent Computing
(TC) research program.


## Building WATCHMAN

We have not yet produced any binary releases of WATCHMAN.
All users should download and build from source.


### Dependencies

WATCHMAN currently has no **mandatory** run-time dependencies.
There are two mandatory build-time dependencies (in addition to a compiler
and a standard build tool such as `make` or
[Ninja](https://ninja-build.org)).
We use [CMake](https://cmake.org) for build configuration

: we use the
[LLVM Integrated Tester](http://llvm.org/docs/CommandGuide/lit.html) for
running tests, and you cannot build WATCHMAN without the tests.
On FreeBSD, `llvm-lit` can be obtained any of the LLVM packages, whether
bleeding-edge (`llvm-devel`) or stable (`llvm38`, `llvm37`, etc.).

We anticipate adding support for multiple event sources in the future, which
will likely bring **optional** dependencies on [Avro](https://avro.apache.org),
[DTrace](http://dtrace.org),
[libxo](https://juniper.github.io/libxo/libxo-manual.html)
or other serialization / instrumentation / RPC frameworks.


### Get the source

WATCHMAN is [hosted on GitHub](https://github.com/cadets/watchman).
Source code can be obtained with either Git or Subversion:

```sh
$ git clone https://github.com/cadets/watchman
$ svn checkout https://github.com/cadets/watchman/trunk
```


### Build

WATCHMAN can be built in either a Debug or a Release configuration.
Assuming that the `BUILD_TYPE` environment variable is set to either
`Debug` or `Release` and that `llvm-lit` is available in the `PATH`,
WATCHMAN can be built with the following commands:

```sh
$ mkdir ${BUILD_TYPE}
$ cd ${BUILD_TYPE}
$ cmake -D CMAKE_BUILD_TYPE=${BUILD_TYPE} ..
-- The C compiler identification is Clang 3.7.1
-- The CXX compiler identification is Clang 3.7.1
[...]
$ make
```

Even better, using [Ninja](https://ninja-build.org):

```sh
$ mkdir ${BUILD_TYPE}
$ cd ${BUILD_TYPE}
$ cmake -G Ninja -D CMAKE_BUILD_TYPE=${BUILD_TYPE} ..
-- The C compiler identification is Clang 3.7.1
-- The CXX compiler identification is Clang 3.7.1
[...]
$ ninja
```

[CCache](https://ccache.samba.org) can be used by setting the
`CMAKE_C_COMPILER` and `CMAKE_CXX_COMPILER` variables to CCache links:

```sh
$ cmake \
	-D CMAKE_C_COMPILER=/usr/local/libexec/ccache/cc \
	-D CMAKE_CXX_COMPILER=/usr/local/libexec/ccache/c++ \
	[...]
```


### Test

WATCHMAN's internal tests can be run using the `check` target in the
Make or Ninja files generated by CMake:

```sh
$ ninja check
[1/1] Testing libwatchman
```
